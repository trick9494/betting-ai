<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Betting AI ‚Äì MultiSport Pro</title>
    <script src="https://cdn.plot.ly/plotly-2.24.1.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        body {
            background-color: #f8f9fa;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            transition: background-color 0.3s, color 0.3s;
        }
        body.dark-mode {
            background-color: #121212;
            color: #f0f0f0;
        }
        .dark-mode input, .dark-mode select, .dark-mode textarea {
            background-color: #1e1e1e;
            color: #ffffff;
            border: 1px solid #444;
        }
        .dark-mode .accordion-button {
            background-color: #1e1e1e;
            color: #f0f0f0;
        }
        .dark-mode .accordion-body {
            background-color: #1b1b1b;
            color: #f0f0f0;
        }
        .dark-mode .accordion-item {
            border-color: #333;
        }
        .dark-mode button {
            background-color: #333;
            color: #fff;
            border: none;
            padding: 8px 12px;
            cursor: pointer;
        }
        .dark-mode button:hover {
            background-color: #555;
        }
        .header {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            color: white;
            padding: 2rem 0;
            margin-bottom: 2rem;
            border-radius: 0 0 10px 10px;
        }
        .metric-card {
            background-color: #f0f2f6;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid #1f77b4;
            transition: background-color 0.3s;
        }
        .dark-mode .metric-card {
            background-color: #2a2a2a;
        }
        .success-card {
            background-color: #d4edda;
            border-left: 4px solid #28a745;
        }
        .dark-mode .success-card {
            background-color: #1e4620;
        }
        .warning-card {
            background-color: #fff3cd;
            border-left: 4px solid #ffc107;
        }
        .dark-mode .warning-card {
            background-color: #42350e;
        }
        .danger-card {
            background-color: #f8d7da;
            border-left: 4px solid #dc3545;
        }
        .dark-mode .danger-card {
            background-color: #4a1c24;
        }
        .sport-card {
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .sport-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        .active-sport {
            border: 3px solid #0d6efd;
            background-color: #e8f4ff;
        }
        .dark-mode .active-sport {
            background-color: #1e3a5f;
        }
        .hidden {
            display: none;
        }
        .consiglio-box {
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
        }
        .value-positive {
            color: #28a745;
            font-weight: bold;
        }
        .value-negative {
            color: #dc3545;
            font-weight: bold;
        }
        .saved-forecast {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            background-color: white;
            transition: background-color 0.3s;
        }
        .dark-mode .saved-forecast {
            background-color: #2a2a2a;
            border-color: #444;
        }
        .saved-forecast-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        .dark-mode .saved-forecast-header {
            border-bottom-color: #444;
        }
        .toggle-dark-mode {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }
        .form-text {
            font-size: 0.875em;
            color: #6c757d;
        }
        .dark-mode .form-text {
            color: #adb5bd;
        }
        .error-message {
            color: #dc3545;
            font-size: 0.875em;
            margin-top: 5px;
        }
        .chart-container {
            margin-bottom: 20px;
        }
        .ai-analysis-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
        }
        .reason-item {
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            padding: 10px 15px;
            margin: 8px 0;
            border-left: 4px solid #4CAF50;
        }
        .warning-reason {
            border-left-color: #FFC107;
        }
        .danger-reason {
            border-left-color: #F44336;
        }
        .market-badge {
            background: #6f42c1;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.75em;
            margin-left: 8px;
        }
        .tipo-pronostico {
            background: #17a2b8;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.75em;
        }
        .dropdown-menu-pronostico {
            max-height: 400px;
            overflow-y: auto;
        }
        .dropdown-toggle-pronostico {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .dropdown-toggle-pronostico::after {
            margin-left: 10px;
        }
        .giocatore-fields {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-top: 10px;
            border-left: 4px solid #17a2b8;
        }
        .dark-mode .giocatore-fields {
            background-color: #2a2a2a;
        }
        /* Saved panel */
        .saved-panel {
            position: fixed;
            top: 0;
            right: -400px;
            width: 400px;
            height: 100vh;
            background-color: white;
            box-shadow: -5px 0 15px rgba(0,0,0,0.1);
            transition: right 0.3s ease;
            z-index: 1050;
            overflow-y: auto;
            padding: 20px;
        }
        .dark-mode .saved-panel {
            background-color: #1e1e1e;
            color: #f0f0f0;
        }
        .saved-panel.open {
            right: 0;
        }
        .saved-panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #ddd;
        }
        .dark-mode .saved-panel-header {
            border-bottom-color: #444;
        }
        .saved-panel-title {
            font-size: 1.5rem;
            font-weight: bold;
            margin: 0;
        }
        .close-panel {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #6c757d;
        }
        .dark-mode .close-panel {
            color: #adb5bd;
        }
        .saved-item {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            background-color: #f8f9fa;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .saved-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .dark-mode .saved-item {
            background-color: #2a2a2a;
            border-color: #444;
        }
        .saved-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .saved-item-sport {
            font-weight: bold;
            color: #0d6efd;
        }
        .saved-item-date {
            font-size: 0.8rem;
            color: #6c757d;
        }
        .dark-mode .saved-item-date {
            color: #adb5bd;
        }
        .saved-item-match {
            font-weight: bold;
            margin-bottom: 5px;
        }
        .saved-item-forecast {
            margin-bottom: 5px;
        }
        .saved-item-stats {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
        }
        .saved-item-stat {
            text-align: center;
        }
        .saved-item-stat-value {
            font-weight: bold;
            font-size: 1.1rem;
        }
        .saved-item-stat-label {
            font-size: 0.8rem;
            color: #6c757d;
        }
        .dark-mode .saved-item-stat-label {
            color: #adb5bd;
        }
        .saved-item-actions {
            display: flex;
            justify-content: flex-end;
            margin-top: 10px;
        }
        .delete-saved {
            background: none;
            border: none;
            color: #dc3545;
            cursor: pointer;
            font-size: 1.2rem;
        }
        .toggle-saved-panel {
            position: fixed;
            bottom: 80px;
            right: 20px;
            z-index: 1000;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            background-color: #0d6efd;
            color: white;
            border: none;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1040;
            display: none;
        }
        .overlay.active {
            display: block;
        }
        .no-saved {
            text-align: center;
            padding: 40px 20px;
            color: #6c757d;
        }
        .dark-mode .no-saved {
            color: #adb5bd;
        }
        /* Saved detail */
        .saved-detail-panel {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: white;
            z-index: 1060;
            overflow-y: auto;
            padding: 20px;
            display: none;
        }
        .dark-mode .saved-detail-panel {
            background-color: #121212;
            color: #f0f0f0;
        }
        .saved-detail-panel.open {
            display: block;
        }
        .saved-detail-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #ddd;
        }
        .dark-mode .saved-detail-header {
            border-bottom-color: #444;
        }
        .saved-detail-title {
            font-size: 1.5rem;
            font-weight: bold;
            margin: 0;
        }
        .close-detail {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #6c757d;
        }
        .dark-mode .close-detail {
            color: #adb5bd;
        }
    </style>
</head>
<body>
    <!-- Overlay per chiudere i pannelli -->
    <div class="overlay" id="overlay"></div>

    <!-- Pannello dei pronostici salvati -->
    <div class="saved-panel" id="savedPanel">
        <div class="saved-panel-header">
            <h3 class="saved-panel-title"><i class="bi bi-bookmark"></i> Pronostici Salvati</h3>
            <button class="close-panel" id="closePanel"><i class="bi bi-x-lg"></i></button>
        </div>
        <div id="savedForecastsList"></div>
    </div>

    <!-- Pannello di dettaglio del pronostico salvato -->
    <div class="saved-detail-panel" id="savedDetailPanel">
        <div class="saved-detail-header">
            <h3 class="saved-detail-title"><i class="bi bi-graph-up"></i> Dettaglio Pronostico</h3>
            <button class="close-detail" id="closeDetail"><i class="bi bi-x-lg"></i></button>
        </div>
        <div id="savedDetailContent"></div>
    </div>

    <div class="header text-center">
        <h1><i class="bi bi-bullseye"></i> Betting AI ‚Äì MultiSport Pro</h1>
        <p class="lead">Analisi intelligente per TUTTI i mercati dei bookmaker</p>
    </div>

    <div class="container">
        <div class="row mb-4">
            <div class="col-12">
                <h3 class="mb-3">üèÜ Scegli lo sport</h3>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <div class="card sport-card text-center active-sport" id="basket-card" onclick="showSport('basket')">
                            <div class="card-body">
                                <i class="bi bi-basketball fs-1"></i>
                                <h5 class="card-title">Basket</h5>
                                <small class="text-muted">NBA, Euroleague, etc.</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <div class="card sport-card text-center" id="calcio-card" onclick="showSport('calcio')">
                            <div class="card-body">
                                <i class="bi bi-soccer fs-1"></i>
                                <h5 class="card-title">Calcio</h5>
                                <small class="text-muted">Serie A, Champions, etc.</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <hr>

        <!-- BASKET SECTION -->
        <div id="basket-section">
            <h3 class="mb-4"><i class="bi bi-basketball"></i> Basket ‚Äì Analisi Multi-Mercato</h3>

            <div class="row mb-3">
                <div class="col-md-6">
                    <div class="mb-3">
                        <label class="form-label">üèÄ Squadra 1</label>
                        <input type="text" class="form-control" id="basket-squadra1" placeholder="es. Los Angeles Lakers" required>
                        <div class="error-message" id="basket-squadra1-error"></div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="mb-3">
                        <label class="form-label">üèÄ Squadra 2</label>
                        <input type="text" class="form-control" id="basket-squadra2" placeholder="es. Golden State Warriors" required>
                        <div class="error-message" id="basket-squadra2-error"></div>
                    </div>
                </div>
            </div>

            <div class="mb-3">
                <label class="form-label">üéØ Tipo Pronostico Basket</label>
                <div class="dropdown">
                    <button class="btn btn-outline-secondary dropdown-toggle dropdown-toggle-pronostico w-100" type="button" id="dropdownBasket" data-bs-toggle="dropdown" aria-expanded="false">
                        <span id="selected-basket-option">üèÄ Punti Giocatore</span>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-pronostico w-100" aria-labelledby="dropdownBasket">
                        <li><a class="dropdown-item" href="#" onclick="selezionaPronosticoBasket('punti-over-under', 'üèÄ Punti Giocatore')">üèÄ Punti Giocatore<br><small>Over/Under punti giocatore</small></a></li>
                        <li><a class="dropdown-item" href="#" onclick="selezionaPronosticoBasket('rimbalzi-over-under', 'üìà Rimbalzi Giocatore')">üìà Rimbalzi Giocatore<br><small>Over/Under rimbalzi</small></a></li>
                        <li><a class="dropdown-item" href="#" onclick="selezionaPronosticoBasket('assist-over-under', 'üéØ Assist Giocatore')">üéØ Assist Giocatore<br><small>Over/Under assist</small></a></li>
                        <li><a class="dropdown-item" href="#" onclick="selezionaPronosticoBasket('performance-multipla', '‚≠ê Performance Multiple')">‚≠ê Performance Multiple<br><small>Punti+Rimbalzi+Assist</small></a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="#" onclick="selezionaPronosticoBasket('vincitore', 'üèÜ Vincitore Partita')">üèÜ Vincitore Partita<br><small>1, X, 2</small></a></li>
                        <li><a class="dropdown-item" href="#" onclick="selezionaPronosticoBasket('handicap', '‚öñÔ∏è Handicap')">‚öñÔ∏è Handicap<br><small>Handicap punti</small></a></li>
                        <li><a class="dropdown-item" href="#" onclick="selezionaPronosticoBasket('punti-totali', 'üî¢ Punti Totali Partita')">üî¢ Punti Totali Partita<br><small>Over/Under punti totali</small></a></li>
                        <li><a class="dropdown-item" href="#" onclick="selezionaPronosticoBasket('custom', '‚úèÔ∏è Personalizzato')">‚úèÔ∏è Personalizzato<br><small>Altri mercati</small></a></li>
                    </ul>
                </div>
                <input type="hidden" id="basket-tipo-pronostico" value="punti-over-under">
            </div>

            <div class="mb-3">
                <label class="form-label">üìä Pronostico Specifico</label>
                <input type="text" class="form-control" id="basket-pronostico" placeholder="es. LeBron James Over 27.5 punti" required>
                <div class="error-message" id="basket-pronostico-error"></div>
                <div class="form-text" id="basket-esempi-pronostico">
                    Esempi: "LeBron James Over 27.5 punti", "Jokic Under 9.5 rimbalzi", "Lakers vincenti"
                </div>
            </div>

            <div class="row mb-3">
                <div class="col-md-6">
                    <div class="mb-3">
                        <label class="form-label">üìà Valore statistico rilevante</label>
                        <input type="number" step="0.1" class="form-control" id="basket-totale" value="0" min="0">
                        <div class="form-text">Media punti/rimbalzi/assist del giocatore o squadra</div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="mb-3">
                        <label class="form-label">üî¢ Numero eventi analizzati</label>
                        <input type="number" step="1" class="form-control" id="basket-eventi" value="0" min="0">
                        <div class="form-text">Partite/eventi considerati per la statistica</div>
                    </div>
                </div>
            </div>

            <div class="row mb-3">
                <div class="col-md-6">
                    <div class="mb-3">
                        <label class="form-label">üéØ Soglia pronostico</label>
                        <input type="number" step="0.1" class="form-control" id="basket-soglia" value="0" min="0">
                        <div class="form-text">Soglia del bookmaker (es. 27.5 per Over 27.5 punti)</div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="mb-3">
                        <label class="form-label">üí∞ Quota bookmaker</label>
                        <input type="number" step="0.01" class="form-control" id="basket-quota" value="1.80" min="1.01">
                    </div>
                </div>
            </div>

            <div class="mb-4">
                <label class="form-label">üìä Successi storici</label>
                <input type="text" class="form-control" id="basket-successi" placeholder="es. 6 su 10, 70%">
                <div class="form-text">Quante volte √® successo storicamente? (es. "6/10" o "70%")</div>
            </div>

            <div class="d-grid gap-2">
                <button class="btn btn-primary btn-lg" onclick="analizzaBasket()"><i class="bi bi-cpu"></i> Analisi AI Avanzata</button>
            </div>

            <div id="basket-results" class="mt-4 hidden">
                <h3 class="mb-4">üìä Risultati Analisi Multi-Mercato</h3>

                <div class="row mb-4">
                    <div class="col-md-3">
                        <div class="metric-card">
                            <h6>Probabilit√†</h6>
                            <h3 id="basket-probabilita">0%</h3>
                            <span id="basket-prob-diff">+0.0%</span>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="metric-card">
                            <h6>Quota Teorica</h6>
                            <h3 id="basket-quota-teorica">0.00</h3>
                            <span id="basket-quota-diff">+0.00</span>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="metric-card">
                            <h6>Value Margin</h6>
                            <h3 id="basket-value-margin">+0.0%</h3>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="metric-card">
                            <h6>Mercato</h6>
                            <h3 id="basket-mercato">-</h3>
                            <span id="basket-tipo">-</span>
                        </div>
                    </div>
                </div>

                <div class="chart-container">
                    <div id="basket-grafico-prob"></div>
                    <div id="basket-grafico-quote"></div>
                </div>

                <div class="card mb-4">
                    <div class="card-body">
                        <h5 class="card-title">Dettagli Analisi</h5>
                        <p><strong>üèÄ Match:</strong> <span id="basket-match"></span></p>
                        <p><strong>üìä Pronostico:</strong> <span id="basket-pronostico-result"></span> <span class="tipo-pronostico" id="basket-tipo-badge"></span></p>
                        <p><strong>üìà Media Statistica:</strong> <span id="basket-media"></span></p>
                        <p><strong>üéØ Soglia Bookmaker:</strong> <span id="basket-soglia-result"></span></p>
                        <p><strong>üîç Metodo Analisi:</strong> <span id="basket-metodo"></span></p>
                        <p><strong>üìä Successi Storici:</strong> <span id="basket-successi-result"></span></p>
                    </div>
                </div>

                <div id="basket-analisi-ai" class="ai-analysis-card">
                    <h4 class="text-center mb-4">üß† Analisi Dettagliata AI</h4>
                    <div id="basket-ragionamento-ai"></div>
                </div>

                <div id="basket-consiglio" class="consiglio-box"></div>

                <div class="d-grid gap-2 mt-3">
                    <button class="btn btn-success" onclick="salvaPronostico('basket')"><i class="bi bi-save"></i> Salva Pronostico</button>
                </div>
            </div>
        </div>

        <!-- CALCIO SECTION -->
        <div id="calcio-section" class="hidden">
            <h3 class="mb-4"><i class="bi bi-soccer"></i> Calcio ‚Äì Analisi Multi-Mercato</h3>

            <div class="row mb-3">
                <div class="col-md-6">
                    <div class="mb-3">
                        <label class="form-label">‚öΩ Squadra 1</label>
                        <input type="text" class="form-control" id="calcio-squadra1" placeholder="es. Juventus" required>
                        <div class="error-message" id="calcio-squadra1-error"></div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="mb-3">
                        <label class="form-label">‚öΩ Squadra 2</label>
                        <input type="text" class="form-control" id="calcio-squadra2" placeholder="es. Inter" required>
                        <div class="error-message" id="calcio-squadra2-error"></div>
                    </div>
                </div>
            </div>

            <div class="mb-3">
                <label class="form-label">üéØ Tipo Pronostico Calcio</label>
                <div class="dropdown">
                    <button class="btn btn-outline-secondary dropdown-toggle dropdown-toggle-pronostico w-100" type="button" id="dropdownCalcio" data-bs-toggle="dropdown" aria-expanded="false">
                        <span id="selected-calcio-option">ü•Ö Over/Under Gol</span>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-pronostico w-100" aria-labelledby="dropdownCalcio">
                        <li><h6 class="dropdown-header">üìä Mercati Partita</h6></li>
                        <li><a class="dropdown-item" href="#" onclick="selezionaPronosticoCalcio('over-under-gol', 'ü•Ö Over/Under Gol')">ü•Ö Over/Under Gol<br><small>0.5, 1.5, 2.5, 3.5 gol</small></a></li>
                        <li><a class="dropdown-item" href="#" onclick="selezionaPronosticoCalcio('doppia-chance', 'üîÑ Doppia Chance')">üîÑ Doppia Chance<br><small>1X, X2, 12</small></a></li>
                        <li><a class="dropdown-item" href="#" onclick="selezionaPronosticoCalcio('risultato-esatto', 'üéØ Risultato Esatto')">üéØ Risultato Esatto<br><small>1-0, 2-1, 3-2, etc.</small></a></li>
                        <li><a class="dropdown-item" href="#" onclick="selezionaPronosticoCalcio('gol-nogol', '‚ùå Gol/No Gol')">‚ùå Gol/No Gol<br><small>Gol, No Gol</small></a></li>
                        <li><a class="dropdown-item" href="#" onclick="selezionaPronosticoCalcio('both-teams', '‚öΩ Both Teams to Score')">‚öΩ Both Teams to Score<br><small>Si, No</small></a></li>
                        <li><a class="dropdown-item" href="#" onclick="selezionaPronosticoCalcio('pari-dispari', 'üî¢ Pari/Dispari')">üî¢ Pari/Dispari<br><small>Pari, Dispari</small></a></li>
                        <li><a class="dropdown-item" href="#" onclick="selezionaPronosticoCalcio('tiri-totali', 'üéØ Tiri Totali')">üéØ Tiri Totali<br><small>Over/Under tiri totali partita</small></a></li>
                        <li><a class="dropdown-item" href="#" onclick="selezionaPronosticoCalcio('corner', 'üìê Corner')">üìê Corner<br><small>Over/Under corner</small></a></li>
                        <li><a class="dropdown-item" href="#" onclick="selezionaPronosticoCalcio('cartellini', 'üü® Cartellini')">üü® Cartellini<br><small>Over/Under cartellini</small></a></li>
                        <li><a class="dropdown-item" href="#" onclick="selezionaPronosticoCalcio('primo-tempo', '‚è±Ô∏è Primo Tempo')">‚è±Ô∏è Primo Tempo<br><small>Risultati 1¬∞ tempo</small></a></li>
                        <li><a class="dropdown-item" href="#" onclick="selezionaPronosticoCalcio('vincitore', 'üèÜ Vincitore')">üèÜ Vincitore<br><small>1, X, 2</small></a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><h6 class="dropdown-header">üë§ Mercati Giocatori</h6></li>
                        <li><a class="dropdown-item" href="#" onclick="selezionaPronosticoCalcio('marcatore', '‚öΩ Marcatore')">‚öΩ Marcatore<br><small>Qualsiasi/Primo/Ultimo gol</small></a></li>
                        <li><a class="dropdown-item" href="#" onclick="selezionaPronosticoCalcio('assist', 'üéØ Assist')">üéØ Assist<br><small>Over/Under assist</small></a></li>
                        <li><a class="dropdown-item" href="#" onclick="selezionaPronosticoCalcio('tiri-totali-giocatore', 'üéØ Tiri Totali Giocatore')">üéØ Tiri Totali Giocatore<br><small>Over/Under tiri totali giocatore</small></a></li>
                        <li><a class="dropdown-item" href="#" onclick="selezionaPronosticoCalcio('tiro-porta', 'ü•Ö Tiri in Porta')">ü•Ö Tiri in Porta<br><small>Over/Under tiri in porta</small></a></li>
                        <li><a class="dropdown-item" href="#" onclick="selezionaPronosticoCalcio('cartellini-giocatore', 'üü® Cartellini Giocatore')">üü® Cartellini Giocatore<br><small>Over/Under cartellini</small></a></li>
                        <li><a class="dropdown-item" href="#" onclick="selezionaPronosticoCalcio('falli', 'üëä Falli')">üëä Falli<br><small>Over/Under falli</small></a></li>
                        <li><a class="dropdown-item" href="#" onclick="selezionaPronosticoCalcio('custom-calcio', '‚úèÔ∏è Personalizzato')">‚úèÔ∏è Personalizzato<br><small>Altri mercati calcio</small></a></li>
                    </ul>
                </div>
                <input type="hidden" id="calcio-tipo-pronostico" value="over-under-gol">
            </div>

            <!-- CAMPI GIOCATORE -->
            <div id="calcio-giocatore-fields" class="giocatore-fields hidden">
                <h5 class="mb-3">üë§ Dati Giocatore</h5>
                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label">Nome Giocatore</label>
                            <input type="text" class="form-control" id="calcio-giocatore" placeholder="es. Cristiano Ronaldo">
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label">Squadra Giocatore</label>
                            <select class="form-control" id="calcio-squadra-giocatore">
                                <option value="">Seleziona squadra</option>
                                <option value="squadra1">Squadra 1</option>
                                <option value="squadra2">Squadra 2</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label">üìà Media Statistica Giocatore</label>
                            <input type="number" step="0.1" class="form-control" id="calcio-media-giocatore" value="0" min="0">
                            <div class="form-text" id="calcio-media-giocatore-text">Media gol/assist/tiri/cartellini del giocatore</div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label">üî¢ Partite Analizzate</label>
                            <input type="number" step="1" class="form-control" id="calcio-partite-giocatore" value="0" min="0">
                            <div class="form-text">Numero partite considerate per la statistica</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="mb-3">
                <label class="form-label">üìä Pronostico Specifico</label>
                <input type="text" class="form-control" id="calcio-pronostico" placeholder="es. Over 2.5 gol" required>
                <div class="error-message" id="calcio-pronostico-error"></div>
                <div class="form-text" id="calcio-esempi-pronostico">
                    Esempi: "Over 2.5 gol", "1X", "2-1", "Gol", "Si - Both teams to score"
                </div>
            </div>

            <div class="row mb-3" id="calcio-stats-squadre">
                <div class="col-md-6">
                    <div class="mb-3">
                        <label class="form-label">üìà Media Gol/Eventi Squadra 1</label>
                        <input type="number" step="0.1" class="form-control" id="calcio-media1" value="0" min="0">
                        <div class="form-text" id="calcio-media1-text">Media gol fatti/subiti per la squadra 1</div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="mb-3">
                        <label class="form-label">üìà Media Gol/Eventi Squadra 2</label>
                        <input type="number" step="0.1" class="form-control" id="calcio-media2" value="0" min="0">
                        <div class="form-text" id="calcio-media2-text">Media gol fatti/subiti per la squadra 2</div>
                    </div>
                </div>
            </div>

            <div class="row mb-3">
                <div class="col-md-6">
                    <div class="mb-3">
                        <label class="form-label">üéØ Soglia pronostico</label>
                        <input type="number" step="0.1" class="form-control" id="calcio-soglia" value="0" min="0">
                        <div class="form-text">Soglia del bookmaker (es. 2.5 per Over 2.5 gol)</div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="mb-3">
                        <label class="form-label">üí∞ Quota bookmaker</label>
                        <input type="number" step="0.01" class="form-control" id="calcio-quota" value="1.80" min="1.01">
                    </div>
                </div>
            </div>

            <div class="mb-4">
                <label class="form-label">üìä Successi storici</label>
                <input type="text" class="form-control" id="calcio-successi" placeholder="es. 7 su 10, 65%">
                <div class="form-text">Quante volte √® successo storicamente? (es. "7/10" o "65%")</div>
            </div>

            <div class="d-grid gap-2">
                <button class="btn btn-primary btn-lg" onclick="analizzaCalcio()"><i class="bi bi-cpu"></i> Analisi AI Avanzata</button>
            </div>

            <div id="calcio-results" class="mt-4 hidden">
                <h3 class="mb-4">üìä Risultati Analisi Multi-Mercato</h3>

                <div class="row mb-4">
                    <div class="col-md-3">
                        <div class="metric-card">
                            <h6>Probabilit√†</h6>
                            <h3 id="calcio-probabilita">0%</h3>
                            <span id="calcio-prob-diff">+0.0%</span>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="metric-card">
                            <h6>Quota Teorica</h6>
                            <h3 id="calcio-quota-teorica">0.00</h3>
                            <span id="calcio-quota-diff">+0.00</span>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="metric-card">
                            <h6>Value Margin</h6>
                            <h3 id="calcio-value-margin">+0.0%</h3>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="metric-card">
                            <h6>Mercato</h6>
                            <h3 id="calcio-mercato">-</h3>
                            <span id="calcio-tipo">-</span>
                        </div>
                    </div>
                </div>

                <div class="chart-container">
                    <div id="calcio-grafico-prob"></div>
                    <div id="calcio-grafico-quote"></div>
                </div>

                <div class="card mb-4">
                    <div class="card-body">
                        <h5 class="card-title">Dettagli Analisi</h5>
                        <p><strong>‚öΩ Match:</strong> <span id="calcio-match"></span></p>
                        <p id="calcio-giocatore-info" class="hidden"><strong>üë§ Giocatore:</strong> <span id="calcio-giocatore-result"></span> (<span id="calcio-squadra-giocatore-result"></span>)</p>
                        <p><strong>üìä Pronostico:</strong> <span id="calcio-pronostico-result"></span> <span class="tipo-pronostico" id="calcio-tipo-badge"></span></p>
                        <p id="calcio-media-giocatore-result" class="hidden"><strong>üìà Media Giocatore:</strong> <span id="calcio-media-giocatore-val"></span></p>
                        <p id="calcio-stats-squadre-result"><strong>üìà Media Squadra 1:</strong> <span id="calcio-media1-result"></span> | <strong>Media Squadra 2:</strong> <span id="calcio-media2-result"></span></p>
                        <p><strong>üî¢ Media Combinata:</strong> <span id="calcio-media-combinata"></span></p>
                        <p><strong>üéØ Soglia Bookmaker:</strong> <span id="calcio-soglia-result"></span></p>
                        <p><strong>üîç Metodo Analisi:</strong> <span id="calcio-metodo"></span></p>
                        <p><strong>üìä Successi Storici:</strong> <span id="calcio-successi-result"></span></p>
                    </div>
                </div>

                <div id="calcio-analisi-ai" class="ai-analysis-card">
                    <h4 class="text-center mb-4">üß† Analisi Dettagliata AI</h4>
                    <div id="calcio-ragionamento-ai"></div>
                </div>

                <div id="calcio-consiglio" class="consiglio-box"></div>

                <div class="d-grid gap-2 mt-3">
                    <button class="btn btn-success" onclick="salvaPronostico('calcio')"><i class="bi bi-save"></i> Salva Pronostico</button>
                </div>
            </div>
        </div>
    </div>

    <footer class="bg-dark text-white text-center py-4 mt-5">
        <p class="mb-0">Betting AI ‚Äì MultiSport Pro &copy; 2023. Supporta tutti i mercati dei bookmaker.</p>
    </footer>

    <button class="toggle-dark-mode" onclick="toggleDarkMode()">üåì</button>
    <button class="toggle-saved-panel" id="toggleSavedPanel"><i class="bi bi-bookmark"></i></button>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // VARIABILI GLOBALI
        let savedForecasts = [];
        let currentAnalysisData = {};
        let darkMode = localStorage.getItem('darkMode') === 'true';

        // FUNZIONI BASE
        function calcolaProbabilita(num, den) {
            if (den <= 0 || isNaN(num) || isNaN(den)) return 0.0;
            const prob = (num / den) * 100;
            return Math.round(prob * 10) / 10;
        }
        function calcolaQuotaTeorica(prob) {
            if (prob <= 0 || isNaN(prob)) return 100.0;
            return Math.round(100 / prob * 100) / 100;
        }
        function mostraSezione(sport) {
            document.getElementById('basket-section').classList.add('hidden');
            document.getElementById('calcio-section').classList.add('hidden');
            document.getElementById('basket-card').classList.remove('active-sport');
            document.getElementById('calcio-card').classList.remove('active-sport');
            document.getElementById(sport + '-section').classList.remove('hidden');
            document.getElementById(sport + '-card').classList.add('active-sport');
        }
        function showSport(sport) { mostraSezione(sport); }

        // SELEZIONE PRONOSTICI BASKET
        function selezionaPronosticoBasket(tipo, testo) {
            document.getElementById('basket-tipo-pronostico').value = tipo;
            document.getElementById('selected-basket-option').textContent = testo;
            aggiornaEsempiBasket();
        }

        // SELEZIONE PRONOSTICI CALCIO
        function selezionaPronosticoCalcio(tipo, testo) {
            document.getElementById('calcio-tipo-pronostico').value = tipo;
            document.getElementById('selected-calcio-option').textContent = testo;
            const giocatoreFields = document.getElementById('calcio-giocatore-fields');
            const statsSquadre = document.getElementById('calcio-stats-squadre');
            const tipiGiocatore = ['marcatore','assist','tiri-totali-giocatore','tiro-porta','cartellini-giocatore','falli'];
            if (tipiGiocatore.includes(tipo)) {
                giocatoreFields.classList.remove('hidden');
                statsSquadre.classList.add('hidden');
                aggiornaTestoMediaGiocatore(tipo);
            } else {
                giocatoreFields.classList.add('hidden');
                statsSquadre.classList.remove('hidden');
                aggiornaTestoMediaCalcio(tipo);
            }
            aggiornaEsempiCalcio();
        }

        // AGGIORNA ESEMPI
        function aggiornaEsempiBasket() {
            const tipo = document.getElementById('basket-tipo-pronostico').value;
            const el = document.getElementById('basket-esempi-pronostico');
            switch (tipo) {
                case 'punti-over-under':
                    el.textContent = 'Esempi: "LeBron James Over 27.5 punti", "Curry Under 25.5", "Doncic Over 30.5"'; break;
                case 'rimbalzi-over-under':
                    el.textContent = 'Esempi: "Jokic Over 9.5", "Gobert Under 11.5", "Davis Over 10.5"'; break;
                case 'assist-over-under':
                    el.textContent = 'Esempi: "Trae Young Over 9.5", "Chris Paul Under 8.5", "Haliburton Over 10.5"'; break;
                case 'performance-multipla':
                    el.textContent = 'Esempi: "Jokic Over 40.5 PRA", "Giannis Under 45.5 PRA", "Doncic Over 50.5 PRA"'; break;
                case 'vincitore':
                    el.textContent = 'Esempi: "Lakers vincenti", "Warriors vincenti", "Celtics vincenti"'; break;
                case 'handicap':
                    el.textContent = 'Esempi: "Lakers -5.5", "Warriors +3.5", "Celtics -2.5"'; break;
                case 'punti-totali':
                    el.textContent = 'Esempi: "Over 220.5", "Under 215.5", "Over 230.5"'; break;
                default:
                    el.textContent = 'Inserisci qualsiasi pronostico personalizzato';
            }
        }
        function aggiornaEsempiCalcio() {
            const tipo = document.getElementById('calcio-tipo-pronostico').value;
            const el = document.getElementById('calcio-esempi-pronostico');
            switch (tipo) {
                case 'over-under-gol':
                    el.textContent = 'Esempi: "Over 2.5", "Under 3.5", "Over 1.5"'; break;
                case 'doppia-chance':
                    el.textContent = 'Esempi: "1X", "X2", "12"'; break;
                case 'risultato-esatto':
                    el.textContent = 'Esempi: "2-1", "1-1", "3-0", "0-2"'; break;
                case 'gol-nogol':
                    el.textContent = 'Esempi: "Gol", "No Gol"'; break;
                case 'both-teams':
                    el.textContent = 'Esempi: "BTTS S√¨", "BTTS No"'; break;
                case 'pari-dispari':
                    el.textContent = 'Esempi: "Pari", "Dispari"'; break;
                case 'tiri-totali':
                    el.textContent = 'Esempi: "Over 25.5 tiri totali", "Under 22.5"'; break;
                case 'corner':
                    el.textContent = 'Esempi: "Over 10.5 corner", "Under 8.5"'; break;
                case 'cartellini':
                    el.textContent = 'Esempi: "Over 4.5 cartellini", "Under 3.5"'; break;
                case 'primo-tempo':
                    el.textContent = 'Esempi: "1 primo tempo", "X primo tempo", "Over 1.5 1¬∞ tempo"'; break;
                case 'vincitore':
                    el.textContent = 'Esempi: "1", "X", "2"'; break;
                case 'marcatore':
                    el.textContent = 'Esempi: "Ronaldo marcatore", "Messi primo gol", "Haaland ultimo gol"'; break;
                case 'assist':
                    el.textContent = 'Esempi: "KDB Over 1.5 assist", "Bruno U 2.5"'; break;
                case 'tiri-totali-giocatore':
                    el.textContent = 'Esempi: "Ronaldo Over 3.5 tiri", "Messi Under 4.5"'; break;
                case 'tiro-porta':
                    el.textContent = 'Esempi: "Lewandowski Over 2.5 SOT", "Mbapp√© Under 3.5 SOT"'; break;
                case 'cartellini-giocatore':
                    el.textContent = 'Esempi: "Ramos Over 0.5 cartellini", "Casemiro Under 1.5"'; break;
                case 'falli':
                    el.textContent = 'Esempi: "Neymar Over 2.5 falli", "Zielinski Under 1.5"'; break;
                default:
                    el.textContent = 'Inserisci qualsiasi pronostico personalizzato';
            }
        }

        // Aggiorna descrizioni
        function aggiornaTestoMediaCalcio(tipo) {
            const t1 = document.getElementById('calcio-media1-text');
            const t2 = document.getElementById('calcio-media2-text');
            switch (tipo) {
                case 'tiri-totali':
                    t1.textContent = 'Media tiri totali ‚Äì Squadra 1';
                    t2.textContent = 'Media tiri totali ‚Äì Squadra 2';
                    break;
                case 'corner':
                    t1.textContent = 'Media corner ‚Äì Squadra 1';
                    t2.textContent = 'Media corner ‚Äì Squadra 2';
                    break;
                case 'cartellini':
                    t1.textContent = 'Media cartellini ‚Äì Squadra 1';
                    t2.textContent = 'Media cartellini ‚Äì Squadra 2';
                    break;
                default:
                    t1.textContent = 'Media gol fatti/subiti ‚Äì Squadra 1';
                    t2.textContent = 'Media gol fatti/subiti ‚Äì Squadra 2';
            }
        }
        function aggiornaTestoMediaGiocatore(tipo) {
            const t = document.getElementById('calcio-media-giocatore-text');
            switch (tipo) {
                case 'marcatore': t.textContent = 'Media gol per partita del giocatore'; break;
                case 'assist': t.textContent = 'Media assist per partita del giocatore'; break;
                case 'tiri-totali-giocatore': t.textContent = 'Media tiri totali per partita del giocatore'; break;
                case 'tiro-porta': t.textContent = 'Media tiri in porta per partita del giocatore'; break;
                case 'cartellini-giocatore': t.textContent = 'Media cartellini per partita del giocatore'; break;
                case 'falli': t.textContent = 'Media falli per partita del giocatore'; break;
                default: t.textContent = 'Media statistica per partita del giocatore';
            }
        }

        // VALIDAZIONE
        function validaCampi(sport) {
            let valid = true;
            document.querySelectorAll('.error-message').forEach(el => el.textContent = '');
            const squadra1 = document.getElementById(sport + '-squadra1').value;
            const squadra2 = document.getElementById(sport + '-squadra2').value;
            const pronostico = document.getElementById(sport + '-pronostico').value;

            if (!squadra1?.trim()) {
                document.getElementById(sport + '-squadra1-error').textContent = 'Campo obbligatorio';
                valid = false;
            }
            if (!squadra2?.trim()) {
                document.getElementById(sport + '-squadra2-error').textContent = 'Campo obbligatorio';
                valid = false;
            }
            if (!pronostico?.trim()) {
                document.getElementById(sport + '-pronostico-error').textContent = 'Campo obbligatorio';
                valid = false;
            }

            const numeriDaValidare = [sport + '-totale', sport + '-eventi', sport + '-soglia', sport + '-quota'];
            for (const campo of numeriDaValidare) {
                const el = document.getElementById(campo);
                if (el && isNaN(parseFloat(el.value))) {
                    alert(`Il campo ${campo.replace('-', ' ')} deve contenere un numero valido`);
                    return false;
                }
            }

            if (sport === 'calcio') {
                const tipo = document.getElementById('calcio-tipo-pronostico').value;
                const tipiGiocatore = ['marcatore','assist','tiri-totali-giocatore','tiro-porta','cartellini-giocatore','falli'];
                if (tipiGiocatore.includes(tipo)) {
                    const giocatore = document.getElementById('calcio-giocatore').value;
                    const squadraGiocatore = document.getElementById('calcio-squadra-giocatore').value;
                    if (!giocatore?.trim()) {
                        alert('‚ùå Inserisci il nome del giocatore per i mercati giocatore!');
                        valid = false;
                    }
                    if (!squadraGiocatore) {
                        alert('‚ùå Seleziona la squadra del giocatore!');
                        valid = false;
                    }
                }
            }
            return valid;
        }

        // ANALISI BASKET
        function analizzaBasket() {
            if (!validaCampi('basket')) return;
            const squadra1 = document.getElementById('basket-squadra1').value;
            const squadra2 = document.getElementById('basket-squadra2').value;
            const pronostico = document.getElementById('basket-pronostico').value;
            const totale = parseFloat(document.getElementById('basket-totale').value) || 0;
            const eventi = parseInt(document.getElementById('basket-eventi').value) || 0;
            const soglia = parseFloat(document.getElementById('basket-soglia').value) || 0;
            const quota = parseFloat(document.getElementById('basket-quota').value) || 1.80;
            const successi = document.getElementById('basket-successi').value;
            const tipoPronostico = document.getElementById('basket-tipo-pronostico').value;

            try {
                const media = eventi > 0 ? Math.round((totale / eventi) * 100) / 100 : 0.0;
                let prob, successiTxt, metodo;

                if (successi && successi.includes("su") && successi.trim()) {
                    const parts = successi.split("su");
                    const n = parseInt(parts[0]); const d = parseInt(parts[1]);
                    prob = calcolaProbabilita(n, d);
                    successiTxt = `${n} su ${d}`;
                    metodo = "üìä DATI STORICI";
                } else if (successi && successi.includes("%")) {
                    prob = parseFloat(successi.replace('%', ''));
                    successiTxt = successi;
                    metodo = "üìä DATI STORICI";
                } else {
                    if (media > 0 && soglia > 0) {
                        if (pronostico.toLowerCase().includes("over")) prob = Math.min(80, 50 + (media - soglia) * 8);
                        else if (pronostico.toLowerCase().includes("under")) prob = Math.max(20, 50 - (soglia - media) * 8);
                        else prob = 50.0;
                    } else prob = 50.0;
                    successiTxt = "Stimato da media statistica";
                    metodo = "ü§ñ STIMA AI";
                }

                const quotaTeo = calcolaQuotaTeorica(prob);
                const valueMargin = quotaTeo > 0 ? ((quota / quotaTeo) - 1) * 100 : 0;

                document.getElementById('basket-probabilita').textContent = prob + '%';
                document.getElementById('basket-prob-diff').textContent = (prob - 50 >= 0 ? '+' : '') + (prob - 50).toFixed(1) + '%';
                document.getElementById('basket-prob-diff').className = (prob - 50 >= 0 ? 'value-positive' : 'value-negative');

                document.getElementById('basket-quota-teorica').textContent = quotaTeo.toFixed(2);
                document.getElementById('basket-quota-diff').textContent = (quotaTeo - quota >= 0 ? '+' : '') + (quotaTeo - quota).toFixed(2);
                document.getElementById('basket-quota-diff').className = (quotaTeo - quota >= 0 ? 'value-positive' : 'value-negative');

                document.getElementById('basket-value-margin').textContent = (valueMargin >= 0 ? '+' : '') + valueMargin.toFixed(1) + '%';
                document.getElementById('basket-value-margin').className = (valueMargin >= 0 ? 'value-positive' : 'value-negative');

                document.getElementById('basket-match').textContent = squadra1 + ' vs ' + squadra2;
                document.getElementById('basket-pronostico-result').textContent = pronostico;
                document.getElementById('basket-media').textContent = media;
                document.getElementById('basket-soglia-result').textContent = soglia;
                document.getElementById('basket-metodo').textContent = metodo;
                document.getElementById('basket-successi-result').textContent = successiTxt;

                const tipoTesto = getTipoPronosticoTesto(tipoPronostico);
                document.getElementById('basket-mercato').textContent = tipoTesto.mercato;
                document.getElementById('basket-tipo').textContent = tipoTesto.tipo;
                document.getElementById('basket-tipo-badge').textContent = tipoTesto.badge;

                creaGraficoAnalisi(prob, quota, quotaTeo, "Basket", "basket-grafico");

                const analisiDettagliata = generaAnalisiDettagliataAI('basket', pronostico, media, soglia, prob, quota, quotaTeo, valueMargin, successiTxt, metodo);
                document.getElementById('basket-ragionamento-ai').innerHTML = analisiDettagliata;

                const consiglio = analisiAvanzataAI(pronostico, media, soglia, prob, quota, quotaTeo);
                document.getElementById('basket-consiglio').innerHTML = consiglio;

                currentAnalysisData = {
                    sport: 'basket', squadra1, squadra2, pronostico, media, soglia, prob, quota, quotaTeo,
                    valueMargin, successiTxt, metodo, tipoPronostico, analisiDettagliata, consiglio
                };

                document.getElementById('basket-results').classList.remove('hidden');
            } catch (e) {
                alert("‚ùå Errore nel calcolo: " + e.message);
            }
        }

        // ANALISI CALCIO
        function analizzaCalcio() {
            if (!validaCampi('calcio')) return;
            const squadra1 = document.getElementById('calcio-squadra1').value;
            const squadra2 = document.getElementById('calcio-squadra2').value;
            const pronostico = document.getElementById('calcio-pronostico').value;
            const media1 = parseFloat(document.getElementById('calcio-media1').value) || 0;
            const media2 = parseFloat(document.getElementById('calcio-media2').value) || 0;
            const soglia = parseFloat(document.getElementById('calcio-soglia').value) || 0;
            const quota = parseFloat(document.getElementById('calcio-quota').value) || 1.80;
            const successi = document.getElementById('calcio-successi').value;
            const tipoPronostico = document.getElementById('calcio-tipo-pronostico').value;

            try {
                let media, prob, successiTxt, metodo;
                const tipiGiocatore = ['marcatore','assist','tiri-totali-giocatore','tiro-porta','cartellini-giocatore','falli'];
                const isMercatoGiocatore = tipiGiocatore.includes(tipoPronostico);

                if (isMercatoGiocatore) {
                    var mediaGiocatore = parseFloat(document.getElementById('calcio-media-giocatore').value) || 0;
                    var partiteGiocatore = parseInt(document.getElementById('calcio-partite-giocatore').value) || 0;
                    media = mediaGiocatore;

                    document.getElementById('calcio-giocatore-info').classList.remove('hidden');
                    document.getElementById('calcio-media-giocatore-result').classList.remove('hidden');
                    document.getElementById('calcio-stats-squadre-result').classList.add('hidden');

                    const giocatore = document.getElementById('calcio-giocatore').value;
                    const squadraGiocatore = document.getElementById('calcio-squadra-giocatore').value;
                    const nomeSquadra = squadraGiocatore === 'squadra1' ? squadra1 : squadra2;

                    document.getElementById('calcio-giocatore-result').textContent = giocatore;
                    document.getElementById('calcio-squadra-giocatore-result').textContent = nomeSquadra;
                    document.getElementById('calcio-media-giocatore-val').textContent = mediaGiocatore;
                } else {
                    media = Math.round((media1 + media2) * 100) / 100;

                    document.getElementById('calcio-giocatore-info').classList.add('hidden');
                    document.getElementById('calcio-media-giocatore-result').classList.add('hidden');
                    document.getElementById('calcio-stats-squadre-result').classList.remove('hidden');

                    document.getElementById('calcio-media1-result').textContent = media1;
                    document.getElementById('calcio-media2-result').textContent = media2;
                }

                if (successi && successi.includes("su") && successi.trim()) {
                    const parts = successi.split("su");
                    const n = parseInt(parts[0]); const d = parseInt(parts[1]);
                    prob = calcolaProbabilita(n, d);
                    successiTxt = `${n} su ${d}`;
                    metodo = "üìä DATI STORICI";
                } else if (successi && successi.includes("%")) {
                    prob = parseFloat(successi.replace('%',''));
                    successiTxt = successi;
                    metodo = "üìä DATI STORICI";
                } else {
                    if (media > 0 && soglia > 0) {
                        if (pronostico.toLowerCase().includes("over")) prob = Math.min(75, 50 + (media - soglia) * 10);
                        else if (pronostico.toLowerCase().includes("under")) prob = Math.max(25, 50 - (soglia - media) * 10);
                        else prob = 50.0;
                    } else prob = 50.0;
                    successiTxt = isMercatoGiocatore ? "Stimato da statistiche giocatore" : "Stimato da medie squadre";
                    metodo = "ü§ñ STIMA AI";
                }

                const quotaTeo = calcolaQuotaTeorica(prob);
                const valueMargin = quotaTeo > 0 ? ((quota / quotaTeo) - 1) * 100 : 0;

                document.getElementById('calcio-probabilita').textContent = prob + '%';
                document.getElementById('calcio-prob-diff').textContent = (prob - 50 >= 0 ? '+' : '') + (prob - 50).toFixed(1) + '%';
                document.getElementById('calcio-prob-diff').className = (prob - 50 >= 0 ? 'value-positive' : 'value-negative');

                document.getElementById('calcio-quota-teorica').textContent = quotaTeo.toFixed(2);
                document.getElementById('calcio-quota-diff').textContent = (quotaTeo - quota >= 0 ? '+' : '') + (quotaTeo - quota).toFixed(2);
                document.getElementById('calcio-quota-diff').className = (quotaTeo - quota >= 0 ? 'value-positive' : 'value-negative');

                document.getElementById('calcio-value-margin').textContent = (valueMargin >= 0 ? '+' : '') + valueMargin.toFixed(1) + '%';
                document.getElementById('calcio-value-margin').className = (valueMargin >= 0 ? 'value-positive' : 'value-negative');

                document.getElementById('calcio-match').textContent = squadra1 + ' vs ' + squadra2;
                document.getElementById('calcio-pronostico-result').textContent = pronostico;
                document.getElementById('calcio-media-combinata').textContent = media;
                document.getElementById('calcio-soglia-result').textContent = soglia;
                document.getElementById('calcio-metodo').textContent = metodo;
                document.getElementById('calcio-successi-result').textContent = successiTxt;

                const tipoTesto = getTipoPronosticoTesto(tipoPronostico);
                document.getElementById('calcio-mercato').textContent = tipoTesto.mercato;
                document.getElementById('calcio-tipo').textContent = tipoTesto.tipo;
                document.getElementById('calcio-tipo-badge').textContent = tipoTesto.badge;

                creaGraficoAnalisi(prob, quota, quotaTeo, "Calcio", "calcio-grafico");

                const analisiDettagliata = generaAnalisiDettagliataAI('calcio', pronostico, media, soglia, prob, quota, quotaTeo, valueMargin, successiTxt, metodo);
                document.getElementById('calcio-ragionamento-ai').innerHTML = analisiDettagliata;

                const consiglio = analisiAvanzataAI(pronostico, media, soglia, prob, quota, quotaTeo);
                document.getElementById('calcio-consiglio').innerHTML = consiglio;

                currentAnalysisData = {
                    sport: 'calcio', squadra1, squadra2, pronostico, media, soglia, prob, quota, quotaTeo,
                    valueMargin, successiTxt, metodo, tipoPronostico, analisiDettagliata, consiglio,
                    isMercatoGiocatore, giocatore: isMercatoGiocatore ? document.getElementById('calcio-giocatore').value : null,
                    squadraGiocatore: isMercatoGiocatore ? document.getElementById('calcio-squadra-giocatore').value : null,
                    mediaGiocatore: isMercatoGiocatore ? mediaGiocatore : null, media1, media2
                };

                document.getElementById('calcio-results').classList.remove('hidden');
            } catch (e) {
                alert("‚ùå Errore nel calcolo: " + e.message);
            }
        }

        // Grafici
        function creaGraficoAnalisi(prob, quota, quotaTeo, sport, containerId) {
            const probContainerId = containerId + '-prob';
            const quoteContainerId = containerId + '-quote';
            const probContainer = document.getElementById(probContainerId);
            const quoteContainer = document.getElementById(quoteContainerId);
            if (probContainer) Plotly.purge(probContainerId);
            if (quoteContainer) Plotly.purge(quoteContainerId);

            const indicatorData = {
                type: "indicator", mode: "gauge+number+delta", value: prob,
                domain: { x: [0,1], y: [0,1] }, title: { text: "Probabilit√† %" },
                delta: { reference: 50 },
                gauge: {
                    axis: { range: [null, 100] },
                    bar: { color: "darkblue" },
                    steps: [
                        { range: [0, 40], color: "lightgray" },
                        { range: [40, 60], color: "yellow" },
                        { range: [60, 100], color: "green" }
                    ],
                    threshold: { line: { color: "red", width: 4 }, thickness: 0.75, value: 60 }
                }
            };
            const barData = {
                type: "bar", x: ['Quota Teorica', 'Quota Bookmaker'], y: [quotaTeo, quota],
                marker: { color: ['lightblue', 'darkblue'] },
                text: [quotaTeo.toFixed(2), quota.toFixed(2)], textposition: 'auto'
            };
            Plotly.newPlot(probContainerId, [indicatorData], { title: `Probabilit√† ${sport}`, height: 400 });
            Plotly.newPlot(quoteContainerId, [barData], { title: `Confronto Quote ${sport}`, height: 400 });
        }

        // Consiglio AI
        function analisiAvanzataAI(esito, media, soglia, prob, quota, quotaTeo) {
            const valueMargin = quotaTeo > 0 ? ((quota / quotaTeo) - 1) * 100 : 0;
            let confidenceScore = 0;
            const lower = esito.toLowerCase();
            if (lower.includes("over")) {
                if (media > soglia * 1.2) confidenceScore += 40;
                else if (media > soglia) confidenceScore += 20;
                else if (media > soglia * 0.9) confidenceScore += 10;
                if (prob > 70) confidenceScore += 30; else if (prob > 60) confidenceScore += 20; else if (prob > 50) confidenceScore += 10;
                if (valueMargin > 20) confidenceScore += 20; else if (valueMargin > 10) confidenceScore += 10; else if (valueMargin > 0) confidenceScore += 5;
                if (media > soglia && prob > 60) confidenceScore += 10;
                return generaConsiglioFinale("OVER", confidenceScore, valueMargin, prob);
            } else if (lower.includes("under")) {
                if (media < soglia * 0.8) confidenceScore += 40;
                else if (media < soglia) confidenceScore += 20;
                else if (media < soglia * 1.1) confidenceScore += 10;
                if (prob > 70) confidenceScore += 30; else if (prob > 60) confidenceScore += 20; else if (prob > 50) confidenceScore += 10;
                if (valueMargin > 20) confidenceScore += 20; else if (valueMargin > 10) confidenceScore += 10; else if (valueMargin > 0) confidenceScore += 5;
                if (media < soglia && prob > 60) confidenceScore += 10;
                return generaConsiglioFinale("UNDER", confidenceScore, valueMargin, prob);
            } else {
                if (prob > 70) confidenceScore += 50;
                else if (prob > 60) confidenceScore += 35;
                else if (prob > 55) confidenceScore += 20;
                else if (prob > 50) confidenceScore += 10;
                if (valueMargin > 15) confidenceScore += 25; else if (valueMargin > 5) confidenceScore += 15; else if (valueMargin > 0) confidenceScore += 5;
                return generaConsiglioFinale(esito.toUpperCase(), confidenceScore, valueMargin, prob);
            }
        }
        function generaConsiglioFinale(tipoScommessa, confidenceScore, valueMargin, prob) {
            if (confidenceScore >= 80) {
                return `<div class="success-card">
                    <h5>üöÄ <strong>FORTE RACCOMANDAZIONE ${tipoScommessa}</strong></h5>
                    <p>Confidenza AI: ${confidenceScore}%</p>
                    <p>üí∞ Value: +${valueMargin.toFixed(1)}% | Probabilit√†: ${prob}%</p>
                    <p>üéØ L'AI √® molto fiduciosa in questa scommessa!</p>
                </div>`;
            } else if (confidenceScore >= 60) {
                return `<div class="warning-card">
                    <h5>‚úÖ <strong>CONSIGLIO ${tipoScommessa}</strong></h5>
                    <p>Confidenza AI: ${confidenceScore}%</p>
                    <p>üí∞ Value: +${valueMargin.toFixed(1)}% | Probabilit√†: ${prob}%</p>
                    <p>üëç Buona opportunit√† secondo l'analisi AI.</p>
                </div>`;
            } else if (confidenceScore >= 40) {
                return `<div class="warning-card">
                    <h5>‚ö†Ô∏è <strong>${tipoScommessa} CON PRUDENZA</strong></h5>
                    <p>Confidenza AI: ${confidenceScore}%</p>
                    <p>üí∞ Value: +${valueMargin.toFixed(1)}% | Probabilit√†: ${prob}%</p>
                    <p>ü§î Possibile ma rischiosa. Considera stake ridotto.</p>
                </div>`;
            } else {
                return `<div class="danger-card">
                    <h5>‚ùå <strong>SCONSIGLIO ${tipoScommessa}</strong></h5>
                    <p>Confidenza AI: ${confidenceScore}%</p>
                    <p>üí∞ Value: +${valueMargin.toFixed(1)}% | Probabilit√†: ${prob}%</p>
                    <p>üö´ I dati non supportano questa scommessa.</p>
                </div>`;
            }
        }

        // Analisi dettagliata AI
        function generaAnalisiDettagliataAI(sport, pronostico, media, soglia, prob, quota, quotaTeo, valueMargin, successi, metodo) {
            let analisiHTML = '';
            const ragionamenti = [];
            if (pronostico.toLowerCase().includes("over")) {
                ragionamenti.push({tipo:"positive",testo:`üìà <strong>Media vs Soglia:</strong> ${media} vs ${soglia} ‚Äì ${media > soglia ? 'favorevole' : 'sfavorevole'} per OVER`});
            } else if (pronostico.toLowerCase().includes("under")) {
                ragionamenti.push({tipo:"positive",testo:`üìâ <strong>Media vs Soglia:</strong> ${media} vs ${soglia} ‚Äì ${media < soglia ? 'favorevole' : 'sfavorevole'} per UNDER`});
            }
            if (prob >= 70) ragionamenti.push({tipo:"positive",testo:`üé≤ <strong>Alta probabilit√†:</strong> ${prob}%`});
            else if (prob >= 60) ragionamenti.push({tipo:"positive",testo:`‚úÖ <strong>Buona probabilit√†:</strong> ${prob}%`});
            else if (prob >= 50) ragionamenti.push({tipo:"warning",testo:`‚öñÔ∏è <strong>Equilibrio:</strong> ${prob}%`});
            else ragionamenti.push({tipo:"negative",testo:`üìä <strong>Bassa probabilit√†:</strong> ${prob}%`});

            if (valueMargin > 15) ragionamenti.push({tipo:"positive",testo:`üí∞ <strong>Value eccellente:</strong> +${valueMargin.toFixed(1)}%`});
            else if (valueMargin > 5) ragionamenti.push({tipo:"positive",testo:`üíµ <strong>Buon value:</strong> +${valueMargin.toFixed(1)}%`});
            else if (valueMargin > 0) ragionamenti.push({tipo:"warning",testo:`üìä <strong>Value limitato:</strong> +${valueMargin.toFixed(1)}%`});
            else ragionamenti.push({tipo:"negative",testo:`‚ùå <strong>Nessun value:</strong> ${valueMargin.toFixed(1)}%`});

            if (metodo.includes("STORICI")) ragionamenti.push({tipo:"positive",testo:`üìö <strong>Dati storici:</strong> ${successi}`});
            else ragionamenti.push({tipo:"warning",testo:`ü§ñ <strong>Stima AI:</strong> calcolo algoritmico`});

            ragionamenti.forEach(r => {
                const c = r.tipo === "positive" ? "reason-item" : r.tipo === "warning" ? "reason-item warning-reason" : "reason-item danger-reason";
                analisiHTML += `<div class="${c}">${r.testo}</div>`;
            });

            let conclusione = '';
            if (prob >= 70 && valueMargin > 10) conclusione = `üéØ <strong>Conclusione:</strong> Alta probabilit√† e buon value. Raccomandazione forte.`;
            else if (prob >= 60 && valueMargin > 5) conclusione = `‚úÖ <strong>Conclusione:</strong> Bilanciamento favorevole. Consigliata con moderazione.`;
            else if (prob >= 50 && valueMargin > 0) conclusione = `‚öñÔ∏è <strong>Conclusione:</strong> Valutazione borderline. Possibile considerazione.`;
            else conclusione = `‚ö†Ô∏è <strong>Conclusione:</strong> Rischio elevato. Non consigliata.`;

            analisiHTML += `<div class="reason-item" style="background: rgba(255,255,255,0.2); border-left-color: #2196F3;">${conclusione}</div>`;
            return analisiHTML;
        }

        // Tipo pronostico testo
        function getTipoPronosticoTesto(tipo) {
            const tipi = {
                'punti-over-under': { mercato: 'Punti', tipo: 'O/U Giocatore', badge: 'üèÄ Punti' },
                'rimbalzi-over-under': { mercato: 'Rimbalzi', tipo: 'O/U Giocatore', badge: 'üìà Rimbalzi' },
                'assist-over-under': { mercato: 'Assist', tipo: 'O/U Giocatore', badge: 'üéØ Assist' },
                'performance-multipla': { mercato: 'Performance', tipo: 'Multipla', badge: '‚≠ê Performance' },
                'vincitore': { mercato: 'Vincitore', tipo: '1/X/2', badge: 'üèÜ Vincitore' },
                'handicap': { mercato: 'Handicap', tipo: 'Punti', badge: '‚öñÔ∏è Handicap' },
                'punti-totali': { mercato: 'Punti Totali', tipo: 'O/U Partita', badge: 'üî¢ P.Totali' },
                'custom': { mercato: 'Personalizzato', tipo: 'Vari', badge: '‚úèÔ∏è Custom' },
                'over-under-gol': { mercato: 'O/U Gol', tipo: 'Gol', badge: 'ü•Ö O/U Gol' },
                'doppia-chance': { mercato: 'Doppia Chance', tipo: '1X/X2/12', badge: 'üîÑ D.Chance' },
                'risultato-esatto': { mercato: 'Ris. Esatto', tipo: 'Score', badge: 'üéØ R.Esatto' },
                'gol-nogol': { mercato: 'Gol/No Gol', tipo: 'G/NG', badge: '‚ùå G/NG' },
                'both-teams': { mercato: 'BTTS', tipo: 'Si/No', badge: '‚öΩ BTTS' },
                'pari-dispari': { mercato: 'Pari/Dispari', tipo: 'P/D', badge: 'üî¢ P/D' },
                'tiri-totali': { mercato: 'Tiri Totali', tipo: 'O/U', badge: 'üéØ Tiri Totali' },
                'corner': { mercato: 'Corner', tipo: 'O/U', badge: 'üìê Corner' },
                'cartellini': { mercato: 'Cartellini', tipo: 'O/U', badge: 'üü® Cartellini' },
                'primo-tempo': { mercato: '1¬∞ Tempo', tipo: 'Parziale', badge: '‚è±Ô∏è 1¬∞T' },
                'marcatore': { mercato: 'Marcatore', tipo: 'Giocatore', badge: '‚öΩ Marcatore' },
                'assist': { mercato: 'Assist', tipo: 'Giocatore', badge: 'üéØ Assist' },
                'tiri-totali-giocatore': { mercato: 'Tiri Totali', tipo: 'Giocatore', badge: 'üéØ Tiri Gioc.' },
                'tiro-porta': { mercato: 'Tiri in Porta', tipo: 'Giocatore', badge: 'ü•Ö Tiri Porta' },
                'cartellini-giocatore': { mercato: 'Cartellini', tipo: 'Giocatore', badge: 'üü® Cart.Gioc.' },
                'falli': { mercato: 'Falli', tipo: 'Giocatore', badge: 'üëä Falli' },
                'custom-calcio': { mercato: 'Personalizzato', tipo: 'Calcio', badge: '‚úèÔ∏è Custom' }
            };
            return tipi[tipo] || { mercato: 'Mercato', tipo: 'Tipo', badge: 'üìä' };
        }

        // PANNELLI
        function toggleSavedPanel() {
            const panel = document.getElementById('savedPanel');
            const overlay = document.getElementById('overlay');
            panel.classList.toggle('open');
            overlay.classList.toggle('active');
        }
        function closeSavedPanel() {
            const panel = document.getElementById('savedPanel');
            const overlay = document.getElementById('overlay');
            panel.classList.remove('open');
            overlay.classList.remove('active');
        }
        function closeDetailPanel() {
            const panel = document.getElementById('savedDetailPanel');
            panel.classList.remove('open');
        }

        function salvaPronostico(sport) {
            const resultsElement = document.getElementById(sport + '-results');
            if (!resultsElement || resultsElement.classList.contains('hidden')) {
                alert('‚ùå Prima devi effettuare un\'analisi per salvare il pronostico!');
                return;
            }
            const squadra1 = document.getElementById(sport + '-squadra1').value;
            const squadra2 = document.getElementById(sport + '-squadra2').value;
            const pronostico = document.getElementById(sport + '-pronostico').value;
            const probabilita = document.getElementById(sport + '-probabilita').textContent;
            const quotaTeorica = document.getElementById(sport + '-quota-teorica').textContent;
            const valueMargin = document.getElementById(sport + '-value-margin').textContent;
            const mercato = document.getElementById(sport + '-mercato').textContent;
            const tipoPronostico = document.getElementById(sport + '-tipo-pronostico').value;

            const forecast = {
                id: Date.now(), sport, squadra1, squadra2, pronostico,
                probabilita, quotaTeorica, valueMargin, mercato, tipoPronostico,
                timestamp: new Date().toLocaleString('it-IT'), analysisData: currentAnalysisData
            };
            savedForecasts.push(forecast);

            try {
                localStorage.setItem('savedForecasts', JSON.stringify(savedForecasts));
            } catch (error) {
                console.error('Errore nel salvataggio:', error);
                alert('Errore durante il salvataggio del pronostico');
                return;
            }
            aggiornaPronosticiSalvati();
            alert('‚úÖ Pronostico salvato con successo!');
        }

        function aggiornaPronosticiSalvati() {
            const container = document.getElementById('savedForecastsList');
            if (!Array.isArray(savedForecasts) || savedForecasts.length === 0) {
                container.innerHTML = `
                    <div class="no-saved">
                        <i class="bi bi-inbox fs-1"></i>
                        <p>Nessun pronostico salvato</p>
                        <small>I tuoi pronostici salvati appariranno qui</small>
                    </div>
                `;
                return;
            }
            savedForecasts.sort((a, b) => b.id - a.id);
            container.innerHTML = savedForecasts.map(f => `
                <div class="saved-item" onclick="mostraDettaglioPronostico(${f.id})">
                    <div class="saved-item-header">
                        <span class="saved-item-sport">${f.sport === 'basket' ? 'üèÄ Basket' : '‚öΩ Calcio'}</span>
                        <span class="saved-item-date">${f.timestamp}</span>
                    </div>
                    <div class="saved-item-match">${f.squadra1} vs ${f.squadra2}</div>
                    <div class="saved-item-forecast">${f.pronostico}</div>
                    <div class="saved-item-stats">
                        <div class="saved-item-stat">
                            <div class="saved-item-stat-value">${f.probabilita}</div>
                            <div class="saved-item-stat-label">Probabilit√†</div>
                        </div>
                        <div class="saved-item-stat">
                            <div class="saved-item-stat-value">${f.quotaTeorica}</div>
                            <div class="saved-item-stat-label">Quota Teorica</div>
                        </div>
                        <div class="saved-item-stat">
                            <div class="saved-item-stat-value ${f.valueMargin.includes('+') ? 'value-positive' : 'value-negative'}">${f.valueMargin}</div>
                            <div class="saved-item-stat-label">Value</div>
                        </div>
                    </div>
                    <div class="saved-item-actions">
                        <button class="delete-saved" onclick="event.stopPropagation(); eliminaPronostico(${f.id})">
                            <i class="bi bi-trash"></i>
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function mostraDettaglioPronostico(id) {
            const forecast = savedForecasts.find(f => f.id === id);
            if (!forecast) return;
            closeSavedPanel();
            const panel = document.getElementById('savedDetailPanel');
            const content = document.getElementById('savedDetailContent');

            let detailHTML = `
                <div class="card mb-4">
                    <div class="card-body">
                        <h5 class="card-title">Informazioni Base</h5>
                        <p><strong>Sport:</strong> ${forecast.sport === 'basket' ? 'üèÄ Basket' : '‚öΩ Calcio'}</p>
                        <p><strong>Match:</strong> ${forecast.squadra1} vs ${forecast.squadra2}</p>
                        <p><strong>Pronostico:</strong> ${forecast.pronostico}</p>
                        <p><strong>Mercato:</strong> ${forecast.mercato}</p>
                        <p><strong>Data Salvataggio:</strong> ${forecast.timestamp}</p>
                    </div>
                </div>

                <div class="row mb-4">
                    <div class="col-md-3">
                        <div class="metric-card">
                            <h6>Probabilit√†</h6>
                            <h3>${forecast.probabilita}</h3>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="metric-card">
                            <h6>Quota Teorica</h6>
                            <h3>${forecast.quotaTeorica}</h3>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="metric-card">
                            <h6>Value Margin</h6>
                            <h3 class="${forecast.valueMargin.includes('+') ? 'value-positive' : 'value-negative'}">${forecast.valueMargin}</h3>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="metric-card">
                            <h6>Mercato</h6>
                            <h3>${forecast.mercato}</h3>
                        </div>
                    </div>
                </div>
            `;
            if (forecast.analysisData) {
                detailHTML += `
                    <div class="chart-container">
                        <div id="saved-detail-grafico-prob"></div>
                        <div id="saved-detail-grafico-quote"></div>
                    </div>

                    <div class="card mb-4">
                        <div class="card-body">
                            <h5 class="card-title">Dettagli Analisi Originale</h5>
                            <p><strong>Media Statistica:</strong> ${forecast.analysisData.media}</p>
                            <p><strong>Soglia Bookmaker:</strong> ${forecast.analysisData.soglia}</p>
                            <p><strong>Metodo Analisi:</strong> ${forecast.analysisData.metodo}</p>
                            <p><strong>Successi Storici:</strong> ${forecast.analysisData.successiTxt}</p>
                        </div>
                    </div>

                    <div class="ai-analysis-card">
                        <h4 class="text-center mb-4">üß† Analisi Dettagliata AI</h4>
                        ${forecast.analysisData.analisiDettagliata}
                    </div>

                    ${forecast.analysisData.consiglio}
                `;
            }
            content.innerHTML = detailHTML;

            if (forecast.analysisData) {
                setTimeout(() => {
                    creaGraficoAnalisi(
                        parseFloat(forecast.probabilita.replace('%', '')),
                        forecast.analysisData.quota,
                        forecast.analysisData.quotaTeo,
                        forecast.sport === 'basket' ? 'Basket' : 'Calcio',
                        "saved-detail-grafico"
                    );
                }, 100);
            }
            panel.classList.add('open');
        }

        function eliminaPronostico(id) {
            if (!confirm('Sei sicuro di voler eliminare questo pronostico?')) return;
            if (!Array.isArray(savedForecasts)) savedForecasts = [];
            savedForecasts = savedForecasts.filter(f => f && f.id !== id);
            try {
                localStorage.setItem('savedForecasts', JSON.stringify(savedForecasts));
                aggiornaPronosticiSalvati();
            } catch (error) {
                console.error('Errore nel salvataggio:', error);
                alert('Errore durante l\'eliminazione del pronostico');
            }
        }

        function toggleDarkMode() {
            darkMode = !darkMode;
            document.body.classList.toggle('dark-mode', darkMode);
            localStorage.setItem('darkMode', darkMode);
        }

        // INIZIALIZZAZIONE
        document.addEventListener('DOMContentLoaded', function() {
            try {
                const saved = localStorage.getItem('savedForecasts');
                savedForecasts = saved ? JSON.parse(saved) : [];
                if (!Array.isArray(savedForecasts)) savedForecasts = [];

                darkMode = localStorage.getItem('darkMode') === 'true';
                if (darkMode) document.body.classList.add('dark-mode');

                mostraSezione('basket');
                aggiornaPronosticiSalvati();
                aggiornaEsempiBasket();
                aggiornaEsempiCalcio();
                aggiornaSquadreGiocatore();

                const toggleSavedPanelBtn = document.getElementById('toggleSavedPanel');
                const closePanelBtn = document.getElementById('closePanel');
                const closeDetailBtn = document.getElementById('closeDetail');
                const overlayEl = document.getElementById('overlay');

                if (toggleSavedPanelBtn) toggleSavedPanelBtn.addEventListener('click', toggleSavedPanel);
                if (closePanelBtn) closePanelBtn.addEventListener('click', closeSavedPanel);
                if (closeDetailBtn) closeDetailBtn.addEventListener('click', closeDetailPanel);
                if (overlayEl) overlayEl.addEventListener('click', function() {
                    closeSavedPanel();
                    closeDetailPanel();
                });
            } catch (error) {
                console.error('Errore nell\'inizializzazione:', error);
                savedForecasts = [];
                mostraSezione('basket');
            }
        });

        function aggiornaSquadreGiocatore() {
            try {
                const squadra1 = document.getElementById('calcio-squadra1').value || 'Squadra 1';
                const squadra2 = document.getElementById('calcio-squadra2').value || 'Squadra 2';
                const select = document.getElementById('calcio-squadra-giocatore');
                if (select && select.options.length > 2) {
                    select.options[1].text = squadra1;
                    select.options[2].text = squadra2;
                }
            } catch (error) {
                console.error('Errore nell\'aggiornamento squadre giocatore:', error);
            }
        }
    </script>
</body>
</html>
   




